(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{5118:(e,t,s)=>{"use strict";s.d(t,{ToastProvider:()=>h,d:()=>g});var a=s(5155),n=s(2115),r=s(7816),o=s(5105);let i=(0,o.A)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),l=(0,o.A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var c=s(5229);let d={success:{icon:r.A,color:"text-green-600",bg:"bg-green-50",border:"border-green-200"},error:{icon:i,color:"text-red-600",bg:"bg-red-50",border:"border-red-200"},warning:{icon:i,color:"text-yellow-600",bg:"bg-yellow-50",border:"border-yellow-200"},info:{icon:l,color:"text-blue-600",bg:"bg-blue-50",border:"border-blue-200"}};function u(e){let{id:t,type:s,title:r,message:o,duration:i=5e3,onClose:l}=e,[u,m]=(0,n.useState)(!0),x=d[s],h=x.icon;return(0,n.useEffect)(()=>{let e=setTimeout(()=>{m(!1),setTimeout(()=>l(t),300)},i);return()=>clearTimeout(e)},[i,t,l]),(0,a.jsx)("div",{className:"transform transition-all duration-300 ease-in-out ".concat(u?"translate-x-0 opacity-100":"translate-x-full opacity-0"),children:(0,a.jsx)("div",{role:"alert",className:"".concat(x.bg," ").concat(x.border," border rounded-lg shadow-lg p-4 max-w-sm w-full"),children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(h,{className:"h-5 w-5 ".concat(x.color)})}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat(x.color),children:r}),o&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:o})]}),(0,a.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,a.jsx)("button",{onClick:()=>{m(!1),setTimeout(()=>l(t),300)},className:"inline-flex ".concat(x.color," hover:opacity-75 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-").concat("error"===s?"red":"success"===s?"green":"warning"===s?"yellow":"blue","-500"),children:(0,a.jsx)(c.A,{className:"h-4 w-4"})})})]})})})}function m(e){let{toasts:t,onClose:s}=e;return(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:t.map(e=>(0,a.jsx)(u,{...e,onClose:s},e.id))})}let x=(0,n.createContext)(void 0);function h(e){let{children:t}=e,[s,r]=(0,n.useState)([]),o=(0,n.useCallback)(e=>{r(t=>t.filter(t=>t.id!==e))},[]),i=(0,n.useCallback)(e=>{let t="toast-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),s={...e,id:t,onClose:o};r(e=>[...e,s])},[o]),l=(0,n.useCallback)((e,t)=>{i({type:"success",title:e,message:t})},[i]),c=(0,n.useCallback)((e,t)=>{i({type:"error",title:e,message:t})},[i]),d=(0,n.useCallback)((e,t)=>{i({type:"warning",title:e,message:t})},[i]),u=(0,n.useCallback)((e,t)=>{i({type:"info",title:e,message:t})},[i]);return(0,a.jsxs)(x.Provider,{value:{showToast:i,showSuccess:l,showError:c,showWarning:d,showInfo:u},children:[t,(0,a.jsx)(m,{toasts:s,onClose:o})]})}function g(){let e=(0,n.useContext)(x);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},5746:(e,t,s)=>{"use strict";s.d(t,{db:()=>h});var a=s(5040),n=s(5704);let r="https://your-project-ref.supabase.co",o="your_publishable_key_here",i=(0,a.UU)(r,o),l=n.env.SUPABASE_SECRET_KEY||o,c=(0,a.UU)(r,l,{auth:{autoRefreshToken:!1,persistSession:!1}});var d=s(5704);class u{async createConversation(e,t,s){console.log("MockDB: Creating conversation with:",{userId:e,title:t,metadata:s});let a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),n=new Date().toISOString(),r={id:a,user_id:e,title:t,created_at:n,updated_at:n,status:"active",metadata:s};return this.conversations.set(a,r),console.log("MockDB: Created conversation:",r),r}async getConversation(e){return this.conversations.get(e)||null}async getConversationsByUser(e){return Array.from(this.conversations.values()).filter(t=>t.user_id===e).sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime())}async updateConversationStatus(e,t){let s=this.conversations.get(e);s&&(s.status=t,s.updated_at=new Date().toISOString())}async addMessage(e,t,s,a){let n={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),conversation_id:e,role:t,content:s,timestamp:new Date().toISOString(),metadata:a},r=this.messages.get(e)||[];return r.push(n),this.messages.set(e,r),n}async getMessagesByConversation(e){return this.messages.get(e)||[]}async submitFeedback(e,t,s,a,n){let r={id:"fb_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),conversation_id:e,user_id:t,satisfaction:s,feedback:a,created_at:new Date().toISOString(),tags:n},o=this.feedback.get(e)||[];return o.push(r),this.feedback.set(e,o),r}async addFeedback(e,t,s,a,n){return this.submitFeedback(e,t,s,a,n)}async getFeedbackStats(e){let t=Array.from(this.feedback.values()).flat(),s=e?t.filter(t=>t.user_id===e):t,a=s.length,n=new Set(s.map(e=>e.conversation_id)).size;return{averageSatisfaction:a>0?s.reduce((e,t)=>e+t.satisfaction,0)/a:0,totalConversations:n,totalFeedback:a}}subscribeToConversation(e,t){return{unsubscribe:()=>{}}}constructor(){this.conversations=new Map,this.messages=new Map,this.feedback=new Map}}class m{async createConversation(e,t,s){let{data:a,error:n}=await c.from("conversations").insert({user_id:e,title:t,metadata:s}).select().single();if(n)throw n;return a}async getConversation(e){let{data:t,error:s}=await i.from("conversations").select("*").eq("id",e).single();if(s)throw s;return t}async getConversationsByUser(e){let{data:t,error:s}=await i.from("conversations").select("*").eq("user_id",e).order("updated_at",{ascending:!1});if(s)throw s;return t||[]}async updateConversationStatus(e,t){let{error:s}=await i.from("conversations").update({status:t}).eq("id",e);if(s)throw s}async addMessage(e,t,s,a){let{data:n,error:r}=await c.from("messages").insert({conversation_id:e,role:t,content:s,metadata:a}).select().single();if(r)throw r;return n}async getMessagesByConversation(e){let{data:t,error:s}=await i.from("messages").select("*").eq("conversation_id",e).order("timestamp",{ascending:!0});if(s)throw s;return t||[]}async submitFeedback(e,t,s,a,n){let{data:r,error:o}=await c.from("feedback").insert({conversation_id:e,user_id:t,satisfaction:s,feedback:a,tags:n}).select().single();if(o)throw o;return r}async addFeedback(e,t,s,a,n){return this.submitFeedback(e,t,s,a,n)}async getFeedbackStats(e){let t=i.from("feedback").select("satisfaction, conversation_id");e&&(t=t.eq("user_id",e));let{data:s,error:a}=await t;if(a)throw a;let n=s||[],r=n.length,o=new Set(n.map(e=>e.conversation_id)).size;return{averageSatisfaction:r>0?n.reduce((e,t)=>e+t.satisfaction,0)/r:0,totalConversations:o,totalFeedback:r}}subscribeToConversation(e,t){return i.channel("conversation:".concat(e)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"conversation_id=eq.".concat(e)},t).subscribe()}}let x=()=>"true"===d.env.CI||"https://your-project-ref.supabase.co".includes("test.supabase.co")||"https://your-project-ref.supabase.co".includes("your-project-ref")||"https://your-project-ref.supabase.co".includes("placeholder.supabase.co");if(x()&&!d.env.CI)throw console.error("\uD83D\uDEA8 CRITICAL ERROR: Cannot use mock database in production!"),console.error("\uD83D\uDEA8 Production environment requires real Supabase configuration"),console.error("\uD83D\uDEA8 This is a CRITICAL configuration error that must be fixed immediately."),Error("CRITICAL CONFIGURATION ERROR: Mock database cannot be used in production environment");console.log("Database: Using mock database for testing (isTestMode =",x(),")");let h=x()?(s.g.__mockDb||(s.g.__mockDb=new u),s.g.__mockDb):new m},7706:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var a=s(5155),n=s(2115),r=s(63),o=s(5105);let i=(0,o.A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var l=s(9347),c=s(9559);let d=(0,o.A)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),u=(0,o.A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);var m=s(5118);let x={AGENT_PROCESSING:12e4,API_ROUTE:13e4,FRONTEND_COMPONENT:14e4,RETRY_ATTEMPTS:2,RETRY_DELAY_BASE:1e3};function h(e){let{conversationId:t,userId:s,initialMessages:r=[],onMessageSent:o}=e,[i,l]=(0,n.useState)(r),[h,g]=(0,n.useState)(""),[p,f]=(0,n.useState)(!1),[y,b]=(0,n.useState)(null),[v,w]=(0,n.useState)(0),[j,N]=(0,n.useState)(null),k=(0,n.useRef)(null),{showError:C,showSuccess:S,showWarning:_}=(0,m.d)();(0,n.useEffect)(()=>{l(r)},[r]),(0,n.useEffect)(()=>{var e;null==(e=k.current)||e.scrollIntoView({behavior:"smooth"})},[i]);let T=async function(){var e,a,n,r,c,d,u,m,y,v,j;let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1?arguments[1]:void 0,I=S||h.trim();if(console.log("\uD83D\uDE80 sendMessage called with:",{content:I,isLoading:p,retryAttempt:k,conversationId:t}),!I||p)return void console.log("⏹️ sendMessage early return:",{hasContent:!!I,isLoading:p});console.log("Sending message:",I),0===k&&(g(""),f(!0),b(Date.now()));try{let a={id:"temp-".concat(Date.now()),conversation_id:t,role:"user",content:I,timestamp:new Date().toISOString(),metadata:{}};0===k&&(l(e=>[...e,a]),null==o||o(a));let n=new AbortController,r=setTimeout(()=>n.abort(),function(){if(x.FRONTEND_COMPONENT<=x.API_ROUTE)throw Error("Frontend component timeout must be longer than API route timeout");if(x.API_ROUTE<=x.AGENT_PROCESSING)throw Error("API route timeout must be longer than agent processing timeout");return x}().FRONTEND_COMPONENT),c=await fetch("/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:t,userId:s,messages:[...i,a],retryAttempt:k}),signal:n.signal});if(clearTimeout(r),!c.ok){let e=await c.json();if(console.log("API error response:",{status:c.status,statusText:c.statusText,errorData:e,retryAttempt:k}),c.status>=500&&k<2)return N(a),w(k+1),console.log("Setting retryCount to:",k+1),_("Connection Issue","Retrying... (".concat(k+1,"/2)")),await new Promise(e=>setTimeout(e,1e3*Math.pow(2,k))),T(k+1,I);if(e.errorMessage&&k>=2){let s={id:"error-".concat(Date.now()),conversation_id:t,role:"assistant",content:e.errorMessage,timestamp:new Date().toISOString(),metadata:{error:!0}};l(e=>[...e,s]),N(a)}throw Error(e.message||"Failed to get AI response")}let d=await c.json();console.log("API success response:",{hasContent:!!d.content,contentLength:null==(e=d.content)?void 0:e.length,hasModel:!!d.model,data:d});let u={id:d.id||"assistant-".concat(Date.now()),conversation_id:t,role:"assistant",content:d.content,timestamp:new Date().toISOString(),metadata:{model:d.model,usage:d.usage,...d.metadata}};l(e=>[...e,u]),null==o||o(u),w(0),N(null)}catch(i){console.error("Error sending message:",i);let e={id:"temp-".concat(Date.now()),conversation_id:t,role:"user",content:I,timestamp:new Date().toISOString(),metadata:{}};N(e);let s=i instanceof Error?i.message:"Unknown error occurred";if(console.log("Error details:",{name:null==i?void 0:i.name,message:s,retryAttempt:k,errorType:typeof i}),"AbortError"===i.name)C("Request Timeout","The request took too long to complete. Complex requests may take up to 3 minutes. Please try again.");else if((null==(a=i.message)?void 0:a.includes("Failed to fetch"))||(null==(n=i.message)?void 0:n.includes("fetch"))){if(C("Service Unavailable","Chef Chopsky service is currently offline. Please try again in a few moments."),k<2)return N(e),w(k+1),console.log("Connection error - setting retryCount to:",k+1),_("Connection Issue","Retrying... (".concat(k+1,"/2)")),await new Promise(e=>setTimeout(e,1e3*Math.pow(2,k))),T(k+1,I);let s={id:"error-".concat(Date.now()),conversation_id:t,role:"assistant",content:"Sorry, I'm having trouble connecting right now. This might be due to API limits or a temporary issue. Please try again later or check your OpenAI billing status.",timestamp:new Date().toISOString(),metadata:{error:!0}};l(e=>[...e,s]),null==o||o(s)}else if((null==(r=i.message)?void 0:r.includes("NetworkError"))||(null==(c=i.message)?void 0:c.includes("network"))){C("Network Error","Please check your internet connection and try again.");let e={id:"error-".concat(Date.now()),conversation_id:t,role:"assistant",content:"Sorry, I'm having trouble connecting right now. This might be due to API limits or a temporary issue. Please try again later or check your OpenAI billing status.",timestamp:new Date().toISOString(),metadata:{error:!0}};l(t=>[...t,e]),null==o||o(e)}else if((null==(d=i.message)?void 0:d.includes("503"))||(null==(u=i.message)?void 0:u.includes("server_error"))){C("OpenAI API Overload","OpenAI servers are experiencing high load. Please wait a moment and try again.");let e={id:"error-".concat(Date.now()),conversation_id:t,role:"assistant",content:"Sorry, OpenAI servers are currently experiencing high load. Please wait a moment and try again. This is a temporary issue.",timestamp:new Date().toISOString(),metadata:{error:!0,error_type:"api_overload"}};l(t=>[...t,e]),null==o||o(e)}else k>=2?C("Failed to send message","Chef Chopsky is temporarily unavailable. Please try again in a few moments."):0===k&&C("Connection Error","Unable to connect to Chef Chopsky. Please check your internet connection.");if(k>=2&&!(null==(m=i.message)?void 0:m.includes("Failed to fetch"))&&!(null==(y=i.message)?void 0:y.includes("fetch"))&&!(null==(v=i.message)?void 0:v.includes("NetworkError"))&&!(null==(j=i.message)?void 0:j.includes("network"))){let e={id:"error-".concat(Date.now()),conversation_id:t,role:"assistant",content:"Sorry, I'm having trouble connecting right now. This might be due to API limits or a temporary issue. Please try again later or check your OpenAI billing status.",timestamp:new Date().toISOString(),metadata:{error:!0}};l(t=>[...t,e]),null==o||o(e)}}finally{f(!1),b(null)}};return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[i.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()).map(e=>{var t,s;return(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[70%] rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-chef-500 text-white":(null==(t=e.metadata)?void 0:t.error)?"bg-red-50 text-red-900 border border-red-200":"bg-gray-100 text-gray-900"),children:[(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:e.content})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,a.jsx)("p",{className:"text-xs opacity-70",children:new Date(e.timestamp).toLocaleTimeString()}),(null==(s=e.metadata)?void 0:s.error)&&"assistant"===e.role&&(0,a.jsxs)("button",{onClick:()=>{if(j){let e=v+1;console.log("Retry button clicked:",{retryCount:v,newRetryAttempt:e,content:j.content,lastFailedMessageId:j.id}),T(e,j.content)}},className:"flex items-center space-x-1 text-xs text-red-600 hover:text-red-800 transition-colors",children:[(0,a.jsx)(c.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"Retry"})]})]})]})},e.id)}),p&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-gray-100 rounded-lg px-4 py-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(d,{className:"h-4 w-4 animate-spin"}),(0,a.jsxs)("span",{className:"text-gray-600",children:[y&&Math.floor((Date.now()-y)/1e3)>60?"Chef Chopsky is working on a very complex request... This may take up to 3 minutes.":y&&Math.floor((Date.now()-y)/1e3)>30?"Chef Chopsky is working on a complex request... This may take up to 2 minutes.":"Chef Chopsky is thinking...",y&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",Math.floor((Date.now()-y)/1e3),"s)"]})]})]})})}),(0,a.jsx)("div",{ref:k})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("textarea",{value:h,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T())},placeholder:"Ask Chef Chopsky about meal planning...",className:"flex-1 input-field resize-none",rows:1,disabled:p}),(0,a.jsx)("button",{onClick:()=>{console.log("\uD83D\uDD18 Send button clicked!",{inputValue:h.trim(),isLoading:p}),T()},disabled:!h.trim()||p,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:(0,a.jsx)(u,{className:"h-4 w-4"})})]})})]})}var g=s(5229),p=s(5746);function f(e){let{conversationId:t,userId:s,onClose:r,onSubmit:o}=e,[i,c]=(0,n.useState)(0),[d,u]=(0,n.useState)(""),[m,x]=(0,n.useState)([]),[h,f]=(0,n.useState)(!1),y=async e=>{if(e.preventDefault(),0!==i){f(!0);try{await p.db.submitFeedback(t,s,i,d,m),o()}catch(e){console.error("Error submitting feedback:",e)}finally{f(!1)}}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Rate Your Experience"}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(g.A,{className:"h-6 w-6"})})]}),(0,a.jsxs)("form",{onSubmit:y,className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"How satisfied were you with this conversation?"}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:[1,2,3,4,5].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>c(e),className:"p-2 rounded-lg transition-colors ".concat(i>=e?"text-yellow-500 hover:text-yellow-600":"text-gray-300 hover:text-gray-400"),children:(0,a.jsx)(l.A,{className:"h-8 w-8 fill-current"})},e))}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:[0===i&&"Click a star to rate",1===i&&"Poor - Not helpful at all",2===i&&"Fair - Somewhat helpful",3===i&&"Good - Generally helpful",4===i&&"Very Good - Very helpful",5===i&&"Excellent - Extremely helpful"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"What aspects were most important? (optional)"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["recipe_quality","response_time","helpfulness","meal_variety","prep_efficiency","nutritional_balance"].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{x(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},className:"px-3 py-2 rounded-lg text-sm font-medium transition-colors ".concat(m.includes(e)?"bg-chef-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.replace("_"," ")},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"feedback",className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional comments (optional)"}),(0,a.jsx)("textarea",{id:"feedback",value:d,onChange:e=>u(e.target.value),placeholder:"What went well? What could be improved?",className:"input-field resize-none",rows:3})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:0===i||h,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Submitting...":"Submit Feedback"})]})]})]})})}function y(){let e=(0,r.useParams)(),t=(0,r.useRouter)(),s=e.id,[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)([]),[m,x]=(0,n.useState)(!0),[g,p]=(0,n.useState)(!1),[y,b]=(0,n.useState)(!1),v="davis";(0,n.useEffect)(()=>{b(!0)},[]),(0,n.useEffect)(()=>{if(!y)return;let e=async()=>{console.log("Loading conversation via API:",s);let e=!1,t=setTimeout(()=>{console.log("API call timeout, creating mock conversation"),e=!0,x(!1),c({id:s,user_id:"test-user",title:"Test Conversation",status:"active",metadata:{test:!0},created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),u([])},3e3);try{let a=new AbortController,n=setTimeout(()=>a.abort(),2800),r=await fetch("/api/conversations/".concat(s),{method:"GET",signal:a.signal});if(clearTimeout(n),e){console.log("Timeout already triggered, ignoring API result"),clearTimeout(t);return}if(!r.ok){console.warn("Conversation fetch failed:",r.status),clearTimeout(t),c(null),u([]),x(!1);return}let o=await r.json(),i=await fetch("/api/conversations/".concat(s,"/messages"),{method:"GET"}),l=[];i.ok?l=await i.json():console.warn("Messages fetch failed:",i.status),clearTimeout(t),c(o),u(l||[])}catch(t){console.error("Error loading conversation via API:",t),e||(c(null),u([]))}finally{e||x(!1)}};s&&e()},[s,y]);let w=async e=>{console.log("Message sent:",e.id)};return y?m?(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-chef-500"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading conversation..."})]})}):o?(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("button",{onClick:()=>t.push("/"),className:"btn-secondary flex items-center mb-4",children:[(0,a.jsx)(i,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:o.title}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Created ",new Date(o.created_at).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat("active"===o.status?"bg-blue-100 text-blue-800":"completed"===o.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:o.status}),"active"===o.status&&(0,a.jsxs)("button",{onClick:()=>{p(!0)},className:"btn-primary flex items-center",children:[(0,a.jsx)(l.A,{className:"h-4 w-4 mr-2"}),"Complete"]})]})]}),o.metadata&&(0,a.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[o.metadata.csaBox&&(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:["CSA: ",o.metadata.csaBox.length," items"]}),o.metadata.mealCount&&(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[o.metadata.mealCount," meals"]}),o.metadata.prepTime&&(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[o.metadata.prepTime,"min prep"]})]})]}),(0,a.jsx)("div",{className:"card h-[600px]",children:(0,a.jsx)(h,{conversationId:s,userId:v,initialMessages:d,onMessageSent:w})}),g&&(0,a.jsx)(f,{conversationId:s,userId:v,onClose:()=>p(!1),onSubmit:()=>{p(!1),t.push("/")}})]}):(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Conversation not found"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"The conversation you're looking for doesn't exist."}),(0,a.jsx)("button",{onClick:()=>t.push("/"),className:"btn-primary",children:"Back to Dashboard"})]})}):(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-chef-500"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading..."})]})})}},8035:(e,t,s)=>{Promise.resolve().then(s.bind(s,7706))}},e=>{e.O(0,[268,441,255,358],()=>e(e.s=8035)),_N_E=e.O()}]);