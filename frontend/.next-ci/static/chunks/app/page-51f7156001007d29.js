(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5746:(e,s,t)=>{"use strict";t.d(s,{db:()=>h});var a=t(5040),r=t(5704);let n="https://your-project-ref.supabase.co",i="your_publishable_key_here",c=(0,a.UU)(n,i),l=r.env.SUPABASE_SECRET_KEY||i,o=(0,a.UU)(n,l,{auth:{autoRefreshToken:!1,persistSession:!1}});var d=t(5704);class x{async createConversation(e,s,t){console.log("MockDB: Creating conversation with:",{userId:e,title:s,metadata:t});let a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let s=16*Math.random()|0;return("x"===e?s:3&s|8).toString(16)}),r=new Date().toISOString(),n={id:a,user_id:e,title:s,created_at:r,updated_at:r,status:"active",metadata:t};return this.conversations.set(a,n),console.log("MockDB: Created conversation:",n),n}async getConversation(e){return this.conversations.get(e)||null}async getConversationsByUser(e){return Array.from(this.conversations.values()).filter(s=>s.user_id===e).sort((e,s)=>new Date(s.updated_at).getTime()-new Date(e.updated_at).getTime())}async updateConversationStatus(e,s){let t=this.conversations.get(e);t&&(t.status=s,t.updated_at=new Date().toISOString())}async addMessage(e,s,t,a){let r={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let s=16*Math.random()|0;return("x"===e?s:3&s|8).toString(16)}),conversation_id:e,role:s,content:t,timestamp:new Date().toISOString(),metadata:a},n=this.messages.get(e)||[];return n.push(r),this.messages.set(e,n),r}async getMessagesByConversation(e){return this.messages.get(e)||[]}async submitFeedback(e,s,t,a,r){let n={id:"fb_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),conversation_id:e,user_id:s,satisfaction:t,feedback:a,created_at:new Date().toISOString(),tags:r},i=this.feedback.get(e)||[];return i.push(n),this.feedback.set(e,i),n}async addFeedback(e,s,t,a,r){return this.submitFeedback(e,s,t,a,r)}async getFeedbackStats(e){let s=Array.from(this.feedback.values()).flat(),t=e?s.filter(s=>s.user_id===e):s,a=t.length,r=new Set(t.map(e=>e.conversation_id)).size;return{averageSatisfaction:a>0?t.reduce((e,s)=>e+s.satisfaction,0)/a:0,totalConversations:r,totalFeedback:a}}subscribeToConversation(e,s){return{unsubscribe:()=>{}}}constructor(){this.conversations=new Map,this.messages=new Map,this.feedback=new Map}}class m{async createConversation(e,s,t){let{data:a,error:r}=await o.from("conversations").insert({user_id:e,title:s,metadata:t}).select().single();if(r)throw r;return a}async getConversation(e){let{data:s,error:t}=await c.from("conversations").select("*").eq("id",e).single();if(t)throw t;return s}async getConversationsByUser(e){let{data:s,error:t}=await c.from("conversations").select("*").eq("user_id",e).order("updated_at",{ascending:!1});if(t)throw t;return s||[]}async updateConversationStatus(e,s){let{error:t}=await c.from("conversations").update({status:s}).eq("id",e);if(t)throw t}async addMessage(e,s,t,a){let{data:r,error:n}=await o.from("messages").insert({conversation_id:e,role:s,content:t,metadata:a}).select().single();if(n)throw n;return r}async getMessagesByConversation(e){let{data:s,error:t}=await c.from("messages").select("*").eq("conversation_id",e).order("timestamp",{ascending:!0});if(t)throw t;return s||[]}async submitFeedback(e,s,t,a,r){let{data:n,error:i}=await o.from("feedback").insert({conversation_id:e,user_id:s,satisfaction:t,feedback:a,tags:r}).select().single();if(i)throw i;return n}async addFeedback(e,s,t,a,r){return this.submitFeedback(e,s,t,a,r)}async getFeedbackStats(e){let s=c.from("feedback").select("satisfaction, conversation_id");e&&(s=s.eq("user_id",e));let{data:t,error:a}=await s;if(a)throw a;let r=t||[],n=r.length,i=new Set(r.map(e=>e.conversation_id)).size;return{averageSatisfaction:n>0?r.reduce((e,s)=>e+s.satisfaction,0)/n:0,totalConversations:i,totalFeedback:n}}subscribeToConversation(e,s){return c.channel("conversation:".concat(e)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"conversation_id=eq.".concat(e)},s).subscribe()}}let u=()=>"true"===d.env.CI||"https://your-project-ref.supabase.co".includes("test.supabase.co")||"https://your-project-ref.supabase.co".includes("your-project-ref")||"https://your-project-ref.supabase.co".includes("placeholder.supabase.co");if(u()&&!d.env.CI)throw console.error("\uD83D\uDEA8 CRITICAL ERROR: Cannot use mock database in production!"),console.error("\uD83D\uDEA8 Production environment requires real Supabase configuration"),console.error("\uD83D\uDEA8 This is a CRITICAL configuration error that must be fixed immediately."),Error("CRITICAL CONFIGURATION ERROR: Mock database cannot be used in production environment");console.log("Database: Using mock database for testing (isTestMode =",u(),")");let h=u()?(t.g.__mockDb||(t.g.__mockDb=new x),t.g.__mockDb):new m},7076:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>w});var a=t(5155),r=t(2115),n=t(63),i=t(7586),c=t(9347),l=t(1524),o=t(6983),d=t(6173),x=t(7816),m=t(1375),u=t(9559),h=t(7828),p=t(2619),g=t.n(p);let b={active:{icon:o.A,color:"text-blue-600",bg:"bg-blue-100"},completed:{icon:x.A,color:"text-green-600",bg:"bg-green-100"},archived:{icon:m.A,color:"text-gray-600",bg:"bg-gray-100"}};function f(e){let{conversations:s,onRefresh:t}=e,[n,c]=(0,r.useState)(!1),l=async()=>{c(!0),await t(),c(!1)};return 0===s.length?(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(i.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No conversations yet"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"Start your first conversation with Chef Chopsky to get meal planning help."})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:[s.length," conversation",1!==s.length?"s":""]}),(0,a.jsxs)("button",{onClick:l,disabled:n,className:"btn-secondary flex items-center",children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2 ".concat(n?"animate-spin":"")}),"Refresh"]})]}),(0,a.jsx)("div",{className:"space-y-3",children:s.map(e=>{let s=b[e.status],t=s.icon;return(0,a.jsxs)("div",{className:"card hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg ".concat(s.bg),children:(0,a.jsx)(t,{className:"h-5 w-5 ".concat(s.color)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Updated ",(0,d.A)(new Date(e.updated_at),"MMM d, yyyy")]})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)(g(),{href:"/conversations/".concat(e.id),className:"btn-secondary flex items-center",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"View"]})})]}),e.metadata&&(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[e.metadata.csaBox&&(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:["CSA: ",e.metadata.csaBox.length," items"]}),e.metadata.mealCount&&(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.metadata.mealCount," meals"]}),e.metadata.prepTime&&(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[e.metadata.prepTime,"min prep"]})]})})]},e.id)})})]})}var y=t(5229),v=t(6191),j=t(5746);function N(e){let{userId:s,onClose:t,onCreated:n}=e,[i,c]=(0,r.useState)(""),[l,o]=(0,r.useState)(!1),[d,x]=(0,r.useState)({csaBox:[],dietaryPreferences:[],mealCount:10,prepTime:120}),m=async e=>{if(e.preventDefault(),i.trim()){o(!0);try{let e=await j.db.createConversation(s,i.trim(),d);n(e.id)}catch(e){console.error("Error creating conversation:",e),alert("Failed to create conversation. Please try again.")}finally{o(!1)}}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Start New Conversation"}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(y.A,{className:"h-6 w-6"})})]}),(0,a.jsxs)("form",{onSubmit:m,className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Conversation Title"}),(0,a.jsx)("input",{type:"text",id:"title",value:i,onChange:e=>c(e.target.value),placeholder:"e.g., Weekly CSA Meal Planning",className:"input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CSA Box Items"}),(0,a.jsxs)("div",{className:"space-y-2",children:[d.csaBox.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"flex-1 px-3 py-2 bg-gray-50 rounded-lg text-sm",children:e}),(0,a.jsx)("button",{type:"button",onClick:()=>{x(e=>({...e,csaBox:e.csaBox.filter((e,t)=>t!==s)}))},className:"text-red-500 hover:text-red-700",children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})]},s)),(0,a.jsxs)("button",{type:"button",onClick:()=>{let e=prompt("Enter CSA item:");e&&x(s=>({...s,csaBox:[...s.csaBox,e]}))},className:"btn-secondary flex items-center",children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Add CSA Item"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dietary Preferences"}),(0,a.jsxs)("div",{className:"space-y-2",children:[d.dietaryPreferences.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"flex-1 px-3 py-2 bg-gray-50 rounded-lg text-sm",children:e}),(0,a.jsx)("button",{type:"button",onClick:()=>{x(e=>({...e,dietaryPreferences:e.dietaryPreferences.filter((e,t)=>t!==s)}))},className:"text-red-500 hover:text-red-700",children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})]},s)),(0,a.jsxs)("button",{type:"button",onClick:()=>{let e=prompt("Enter dietary preference:");e&&x(s=>({...s,dietaryPreferences:[...s.dietaryPreferences,e]}))},className:"btn-secondary flex items-center",children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Add Preference"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"mealCount",className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Meals"}),(0,a.jsx)("input",{type:"number",id:"mealCount",value:d.mealCount,onChange:e=>x(s=>({...s,mealCount:parseInt(e.target.value)||0})),min:"1",max:"20",className:"input-field"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"prepTime",className:"block text-sm font-medium text-gray-700 mb-2",children:"Prep Time (minutes)"}),(0,a.jsx)("input",{type:"number",id:"prepTime",value:d.prepTime,onChange:e=>x(s=>({...s,prepTime:parseInt(e.target.value)||0})),min:"30",max:"300",className:"input-field"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:l||!i.trim(),className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Creating...":"Start Conversation"})]})]})]})})}function w(){let e=(0,n.useRouter)(),[s,t]=(0,r.useState)([]),[d,x]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0),[h,p]=(0,r.useState)(!1),g="davis";(0,r.useEffect)(()=>{b(),y()},[]);let b=async()=>{try{let e=await j.db.getConversationsByUser(g);t(e)}catch(e){console.error("Error fetching conversations:",e)}finally{u(!1)}},y=async()=>{try{let e=await j.db.getFeedbackStats(g);x(e)}catch(e){console.error("Error fetching stats:",e)}};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Chef Chopsky Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Monitor your AI sous chef conversations and feedback"})]}),d&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(i.A,{className:"h-6 w-6 text-blue-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Conversations"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:d.totalConversations})]})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)(c.A,{className:"h-6 w-6 text-green-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Average Satisfaction"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[d.averageSatisfaction.toFixed(1),"/5"]})]})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-2 bg-purple-100 rounded-lg",children:(0,a.jsx)(l.A,{className:"h-6 w-6 text-purple-600"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Feedback Received"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:d.totalFeedback})]})]})})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Recent Conversations"}),(0,a.jsx)("button",{onClick:()=>p(!0),className:"btn-primary",children:"New Conversation"})]}),m?(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(o.A,{className:"h-6 w-6 text-gray-400 animate-spin mr-2"}),(0,a.jsx)("span",{className:"text-gray-500",children:"Loading conversations..."})]})}):(0,a.jsx)(f,{conversations:s,onRefresh:b}),h&&(0,a.jsx)(N,{userId:g,onClose:()=>p(!1),onCreated:s=>{p(!1),b(),e.push("/conversations/".concat(s))}})]})}},7752:(e,s,t)=>{Promise.resolve().then(t.bind(t,7076))}},e=>{e.O(0,[268,924,441,255,358],()=>e(e.s=7752)),_N_E=e.O()}]);